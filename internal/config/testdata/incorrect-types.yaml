flowit:
  version: "0.1"
  config:
    # The following line is invalid. Should be a boolean
    abort-on-failed-action: "true"
    strict: false
    # The following line is invalid. Should be a string
    shell: 12345
  variables:
    gerrit-host: gerrit.review.com
    gerrit-port: 29418
  workflow:
    branches:
      # The following line is invalid. Should be a list
      id: master
      name: master
      eternal: true
      protected: false

    stages:
    - development:
      - id: start
        args: < jira-issue-id | Related Jira Issue ID >
        conditions:
        - "[[ $(jira list --status $<jira-issue-id>) == *'Open'* ]]"
        actions:
        - git checkout master
        - git pull origin master
        - jira transition $<jira-issue-id> 'In progress'

      - id: sync
        actions:
        - git checkout master
        - git pull origin master

      - id: publish
        conditions:
        - ./run-tests.sh
        - "[[ $(jira list --status $<jira-issue-id>) == *'In Progress'* ]]"
        actions:
        - git checkout master
        - git push origin HEAD:refs/for/master
        - jira transition $<jira-issue-id> 'In code review'

      - id: finish
        conditions:
        - "[[ $(ssh -p $<gerrit-port> $<gerrit-host> gerrit review $(git rev-parse master)) == *'+2'* ]]"
        actions:
        - ssh -p $<gerrit-port> $<gerrit-host> gerrit review --submit $(git rev-parse master)
        - git checkout master
        - git pull origin master
        - jira transition $<jira-issue-id> 'Done'
